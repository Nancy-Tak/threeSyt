{% extends "_layout/alpha/layout-alpha.html" %}

{# 加载页面专有样式表 #}
{% block css %}
    <link rel="stylesheet" href="{{ static }}/js/webuploader/style.css">
    <link rel="stylesheet" href="{{ static }}/js/clockpicker/jquery-clockpicker.min.css">
{% endblock %}

{# 内容 #}
{% block content %}

    {# 路径导航 #}
    {{
        breadCrumbAlpha.default(
            list = [
                {
                    link: 'javascript:void(0);',
                    text: '商户管理'
                },
                {
                    link: 'javascript:void(0);',
                    text: '商户列表'
                },
                {
                    text: 审核商户'
                }
            ]
        )
    }}

{# 商户主体信息 #}
<div>
    <div class="tables-title">
        商户提交信息
    </div>
    <table class="table bordered table-view fn-mb-20">
        <tbody>
        <tr>
            <th>商户名称</th>
            <td>北京爱时尚女装有限公司</td>
            <th>商户简称（支付时向消费者展示的名称）</th>
            <td>北京爱时尚女装有限公司</td>
        </tr>
        <tr>
            <th>证件类型</th>
            <td>普通营业执照</td>
            <th>证件号码</th>
            <td>1234567890123</td>
        </tr>
        <tr>
            <th>所在省份</th>
            <td>广东，深圳，福田</td>
            <th>详细地址</th>
            <td>好汉路108号1楼</td>
        </tr>
        <tr>
            <th>联系人姓名</th>
            <td>张宁</td>
            <th>联系人类型</th>
            <td>法人</td>
        </tr>
        <tr>
            <th>联系人证件号码</th>
            <td>450000000000000000</td>
            <th>联系人手机号码</th>
            <td>13888888888</td>
        </tr>
        <tr>
            <th>客服电话</th>
            <td>400000000</td>
            <th>所属行业</th>
            <td>美食，日料</td>
        </tr>
        <tr>
            <th>商户类型</th>
            <td>企业</td>
            <th>门店资料是否提交
            </th>
            <td>否</td>
        </tr>
        <tr>
            <th>结算账户类型
            </th>
            <td>对公</td>
            <th>开户名称</th>
            <td>北京爱时尚女装有限公司
            </td>
        </tr>
        <tr>
            <th>开户银行
            </th>
            <td>招商银行
            </td>
            <th>开户行省份城市
            </th>
            <td>广东，广州
            </td>
        </tr>
        <tr>
            <th>分支行
            </th>
            <td>招商银行广州分行体育西路支行
            </td>
            <th>银行卡号
            </th>
            <td>622222222222222222
            </td>
        </tr>

        </tbody>
    </table>
</div>

    <div class="form-frame">
        <form autocomplete="off">

 {#  审核信息#}
       <div class="form-title">
           审核信息
            </div>
       <div class="form-layer1">
                <div class="form-layer2">
                    <div class="form-group">
                       <label class="form-control-label">
                          <span> 审核结果 </span>
                          <em> : </em>
                       </label>
                       <div class="form-control-wrap">
                          <div class="form-control-check">
                                <label>
                                    通过
                                    <input type="radio" class="j-type" name="type" value="0" checked="checked">
                                </label>
                                <label>
                                   不通过
                                    <input type="radio" class="j-type" id="private" name="type" value="1">
                                </label>
                            </div>
                       </div>
                    </div>
                    <div class="form-group">
                        <label class="form-control-label">
                            <span> 备注（此处在公众号显示给商户） </span>
                            <em> : </em>
                        </label>
                        <div class="form-control-wrap">
                            <textarea type="text" class="form-control" style="resize:none; height: 100px !important;" placeholder="不超过30字" id="" cols="30" rows="10"  ></textarea>
                        </div>
                    </div>

                </div>
            </div>

           {#商户参数配置#}
            <div class="form-title">
                商户参数配置
            </div>
            <div class="form-layer1">
                <div class="form-layer2">
                    {# 退款日设置 #}
                    <div class="form-group">
                        <label class="form-control-label">
                            <b> * </b>
                            <span> 退款日设置 </span>
                            <em> : </em>
                        </label>
                        <div class="form-control-wrap">
                            <input type="text" class="form-control-alpha" />

                            <div class="tooltips-icon-alpha" style="width:18px; height:18px; background-color:#009DD9; line-height:18px; border-radius: 8px; color: white;">
                                ?
                                <div class="tooltips" style="height: auto; top:-125px; text-align: left;">
                                    <div>
                                        设置0天为不可发起退款
                                    </div>
                                    <div>
                                        设置1天为当天24点前可发起退款
                                    </div>
                                    <div>
                                        设置2天为消费后第二天24点前可发起退款.以此类推
                                    </div>
                                    <div>
                                        请按照支付宝与微信退款规则最小日期设置，方可生效
                                    </div>
                                    <span class="tips-arrow-border"></span>
                                    <span class="tips-arrow"></span>
                                </div>
                            </div>

                            <!--<div data-toggle="tooltips" data-pos="bottom-right" title="设置0天为不可发起退款，-->
                            <!--设置1天为当天24点前可发起退款，-->
                            <!--设置2天为消费后第二天24点前可发起退款，-->
                            <!--以此类推。-->
                            <!--请按照支付宝与微信退款规则最小日期设置，方可生效。" class="inline-block text-align-center" style="width:16px; height:16px; background-color:#009DD9; line-height:16px; border-radius: 8px; color: white;"> ? </div>-->
                        </div>
                    </div>
                </div>
            </div>
        </form>

        {# 按钮 #}
        <div class="text-align-center fn-mt-20">
            <button id="submit" type="button" class="btn primary">提交</button>
            <a href="关联商户管理-商户列表.html" class="btn default">取消</a>
        </div>
    </div>
    </div>



{% endblock %}

{% block js %}
    <script src="{{ static }}/js/webuploader/webuploader.js"></script>
    <script src="{{ static }}/js/webuploader/uploader.js"></script>
    <script src="{{ static }}/js/clockpicker/jquery-clockpicker.min.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=MtoHfKTGzxoZlYeCACbOwmDipRIV5hcf"></script>
{% endblock %}

{% block jsPage %}
    <script type="text/javascript">
        /**
         * uploadSuccess 上传成功后回调
         * @return {[type]} [description]
         */
        function uploadSuccess(el, file, data) {
            /*var names = data.name.split('.');
            var name = names[0].length > 13 ? names[0].substring(0, 13) + "..." : names[0];
            $(el).siblings(".uploadName").val(data.name);
            $(el).siblings(".upload-name").text(name + "." + names[1]);
            $(el).siblings(".upload-path").val(data.path);
            $(el).siblings(".upload-size").val(data.size);*/
            // todo: test
            $(el).siblings(".upload-name").html(file.name);

        }

        /*

        //  一些把百度坐标转换为高德坐标的方法
        var AMAP_KEY = '2248bf4f7e5ac866a003c164d83063e8';  //  高德账号的key值
        function getAmapPointUrl(locations){
            var url = 'http://restapi.amap.com/v3/assistant/coordinate/convert?coordsys=baidu&output=json';
            url += '&key=' + AMAP_KEY + '&locations=' + locations + '&callback=?';
            return url;
        }

        function toFixed(pointArr,num){
            var DIGIT = Math.pow(10,num);
            var POINT = {
                x : singleFixed(pointArr[0]),
                y : singleFixed(pointArr[1])
            };

            return POINT;

            function singleFixed(key){
                return (parseInt(key * DIGIT)/DIGIT).toFixed(num);
            }
        }

        var bdMap;
        //  百度地图
        (function(){
            function G(id) {
              return document.getElementById(id);
            }
            // 百度地图API功能
            var map = new BMap.Map("bdMapContainer",{enableMapClick:false});
            bdMap = map;
            map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);
            function setCoordinate(e){
              //  e.point.lng
              //  e.point.lat
              $("[name=bd-x]").val(e.point.lng);
              $("[name=bd-y]").val(e.point.lat);

              var locations = [e.point.lng, e.point.lat].join(',');
              var url = getAmapPointUrl(locations);

              $.getJSON(url,function(res){
                  if(res.infocode == 10000){
                      //    请求成功
                      var POINT = toFixed(res.locations.split(','), 6);
                      $("[name=gd-x]").val(POINT.x);
                      $("[name=gd-y]").val(POINT.y);
                  }else{
                      //    请求失败
                      console.log('高德转换接口错误，错误码：' + res.infocode);
                  }
              });
              // console.log(e.point.lng + ", " + e.point.lat);
              $("#bdMap").addClass("invisible");
            }
            map.addEventListener("click", setCoordinate);
            map.enableScrollWheelZoom(true);

            var ac = new BMap.Autocomplete(    //建立一个自动完成的对象
              {"input" : "suggestId"
              ,"location" : map
            });

            ac.addEventListener("onhighlight", function(e) {  //鼠标放在下拉列表上的事件
              var str = "";
              var _value = e.fromitem.value;
              var value = "";
              if (e.fromitem.index > -1) {
                value = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
              }
              str = "FromItem<br />index = " + e.fromitem.index + "<br />value = " + value;

              value = "";
              if (e.toitem.index > -1) {
                _value = e.toitem.value;
                value = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
              }
              str += "<br />ToItem<br />index = " + e.toitem.index + "<br />value = " + value;
              G("searchResultPanel").innerHTML = str;
            });

            var myValue;
            ac.addEventListener("onconfirm", function(e) {    //鼠标点击下拉列表后的事件
              var _value = e.item.value;
              myValue = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
              G("searchResultPanel").innerHTML ="onconfirm<br />index = " + e.item.index + "<br />myValue = " + myValue;

              setPlace();
            });

            function setPlace(){
              map.clearOverlays();    //清除地图上所有覆盖物
              function myFun(){
                var pp = local.getResults().getPoi(0).point;    //获取第一个智能搜索的结果
                map.centerAndZoom(pp, 18);
                map.addOverlay(new BMap.Marker(pp));    //添加标注
              }
              var local = new BMap.LocalSearch(map, { //智能搜索
                onSearchComplete: myFun
              });
              local.search(myValue);
            }
        })();

         */
         // dom准备完时加载
        $(function(){

            $(".j-type").on("change",function(){
                var isPrivateChecked = $("#private").prop("checked");
                if(isPrivateChecked){
                    $("#identity").removeClass("display-none");
                }else{
                    $("#identity").addClass("display-none");
                }
            });

            /*$('.j-upload-btn').fileUpload({
                swf: './static/js/webuploader/Uploader.swf',
                sendurl: 'http://localhost/fileupload.php',
                //fileVal: 'FileData',
                success: uploadSuccess
            });*/
            //初始化上传控件
            $(".upload-img").InitUploader({ sendurl: "http://192.168.7.129/fileupload.php", swf: "./static/js/webuploader/uploader.swf" });

            $('.clockpicker').clockpicker();

            $("#submit").on("click",function(){
              $.tipsModal({
//                  close:  close ,
                  // modalTitle:"test",
                type : 'success',   //  success info error
                title : '<span class="success-FontColor2">审核成功！</span>',
                content : '<div><a href="商户合同管理-创建合同.html" class="btn secondary" role="button">关联合同</a></div>',
//                 buttons : {  //  按钮可以只传ok或cancel
//                   ok : {
//                     text : '创建合同',
//                     callback : function () {
//                       console.log('确定');
//
//
//                     }
//                   },
                //   cancel : {
                //     text : '取消',
                //     callback : function () {
                //       console.log('取消');
                //     }
                //   }
//                 }
              });
            });


            var initSelectContent = "<option value=''>请选择</option>";
            //  省市区（县），三级联动

            //  省市联动
            $("#a-province").on("change",function(){
                //  清空城市和区县下拉选择
                $("#a-city").html(initSelectContent);
                $("#a-area").html(initSelectContent);

                var provinceCode = $("#a-province").val();

                if(provinceCode != ""){
                   $.ajax({
                        //  通过省份id获取城市列表的接口
                        url: "/EAccountUser/GetCityList",
                        data: "provinceID=" + provinceCode,
                        method: "post",
                        success: function (result) {
                            var cities = result.Data;
                            var cityHtml = initSelectContent;
                            for (var i = 0; i < cities.length; i++) {
                                cityHtml += '\r\n<option value="' + cities[i].CityID + '">' + cities[i].CityName + '</option>';
                            }
                            $("#a-city").html(cityHtml);
                        },
                        error: function (msg) {

                        }
                    });
                }
            });

            // 接口返回数据格式
            // {
            //     Code: "100",
            //     Success: true,
            //     Total: 0,
            //     Message: "操作成功！",
            //     Data: [
            //         {
            //             ID: 4766,
            //             CityID: "1000",
            //             CityName: "北京市",
            //             ProvinceID: "11",
            //             Accseq: 10
            //         }
            //     ]
            // }

            //  市区（县）联动
            $("#a-city").on("change",function(){
                //  清空区县下拉选择
                $("#a-area").html(initSelectContent);

                var cityCode = $("#a-province").val();

                if(cityCode != ""){
                   $.ajax({
                        //  通过城市id获取区县列表的接口
                        url: "/EAccountUser/GetAreaList",
                        data: "cityID=" + cityCode,
                        method: "post",
                        success: function (result) {
                            var areas = result.Data;
                            var areaHtml = initSelectContent;
                            for (var i = 0; i < cities.length; i++) {
                                areaHtml += '\r\n<option value="' + areas[i].AreaID + '">' + areas[i].AreaName + '</option>';
                            }
                            $("#a-area").html(cityHtml);
                        },
                        error: function (msg) {

                        }
                    });
                }
            });

            // 接口返回数据格式
            // {
            //     Code: "100",
            //     Success: true,
            //     Total: 0,
            //     Message: "操作成功！",
            //     Data: [
            //         {
            //             ID: 4766,
            //             AreaID: "1000",
            //             AreaName: "北京市",
            //             CityID: "11",
            //             Accseq: 10
            //         }
            //     ]
            // }


            //  结算账户联动交互

            //省份改变
            $("#ProvinceCode").change(function () {
                //清空城市和开户支行
                $("#BranchBankCode").html(initSelectContent);
                $("#CityCode").html(initSelectContent);

                var code = $("#ProvinceCode").val();
                if (code != "") {
                    $.ajax({
                        //  通过省份id获取城市列表的接口
                        url: "/EAccountUser/GetCityList",
                        data: "provinceID=" + code,
                        method: "post",
                        success: function (result) {
                            var cities = result.Data;
                            var cityHtml = initSelectContent;
                            for (var i = 0; i < cities.length; i++) {
                                cityHtml += '\r\n<option value="' + cities[i].CityID + '">' + cities[i].CityName + '</option>';
                            }
                            $("#CityCode").html(cityHtml);
                        },
                        error: function (msg) {

                        }
                    });
                }
            });

            // 接口返回数据格式
            // {
            //     Code: "100",
            //     Success: true,
            //     Total: 0,
            //     Message: "操作成功！",
            //     Data: [
            //         {
            //             ID: 4766,
            //             CityID: "1000",
            //             CityName: "北京市",
            //             ProvinceID: "11",
            //             Accseq: 10
            //         }
            //     ]
            // }

            //开户行改变，更新开户支行选择
            $("#BankCode").change(function () {
                //  清空开户支行
                $("#BranchBankCode").html(initSelectContent);

                var bankCode = $("#BankCode").val();
                var bankName = $("#BankCode").find("option:selected").text();
                var provincecode = $("#ProvinceCode").val();
                var cityCode = $("#CityCode").val();
                if (bankCode != "" && provincecode != "" && cityCode != "") {
                    $.ajax({
                        //  通过城市和银行获取分支行列表的接口
                        url: "/EAccountUser/GetBranchBankList",
                        data: "cityCode=" + cityCode + "&bankName=" + bankName,
                        method: "post",
                        success: function (result) {
                            var items = result.Data;
                            var html = initSelectContent;
                            for (var i = 0; i < items.length; i++) {
                                html += '<option value="' + items[i].BankCode + '">' + items[i].Lname + '</option>';
                            }
                            $("#BranchBankCode").html(html);
                        },
                        error: function (msg) {

                        }
                    });
                }
            });

            // 接口返回数据格式
            // {
            //     Code: "100",
            //     Success: true,
            //     Total: 0,
            //     Message: "操作成功！",
            //     Data: [
            //         {
            //             ID: "A1747755-CD35-4255-A9A9-66DD691A2CB5",
            //             BankCode: "102100000474",
            //             Status: "2",
            //             ClsCode: "102",
            //             DrecCode: "102100009980",
            //             NodeCode: "1000",
            //             CityCode: "1000",
            //             Lname: "中国工商银行北京丰益桥支行",
            //             Address: "北京市丰台区丰管路16号",
            //             PostCode: "100031",
            //             Tel: "010-83833155"
            //         }
            //     ]
            // }


            //  营业执照证件交互
            $(".certificates").on("change",function(){
              //  营业执照是否勾选
              var isCertificatesOneChecked = $("#certificatesOne").prop("checked");

              if(isCertificatesOneChecked){
                $(".cf0").removeClass("display-none");
                $(".cf1").addClass("display-none");
              }else{
                $(".cf0").addClass("display-none");
                $(".cf1").removeClass("display-none");
              }
            });

            //  百度地图交互
            $("#bdMapBtn").on("click",function(){
                var x = $("[name=bd-x]").val();
                var y = $("[name=bd-y]").val();
                if(x != "" && y != ""){
                    bdMap.centerAndZoom(new BMap.Point(x, y), 11);
                }

                $("#bdMap").removeClass("invisible");
            });

            $("#bdMap").on("click",function(e){
                var $target = $(e.target);
                if($target.attr("id") == "bdMap"){
                  $("#bdMap").addClass("invisible");
                }
            });

        });
    </script>
{% endblock %}
